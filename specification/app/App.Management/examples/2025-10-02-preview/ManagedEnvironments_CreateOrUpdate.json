{
  "parameters": {
    "api-version": "2025-10-02-preview",
    "environmentEnvelope": {
      "identity": {
        "type": "SystemAssigned, UserAssigned",
        "userAssignedIdentities": {
          "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/contoso-resources/providers/Microsoft.ManagedIdentity/userAssignedIdentities/contoso-identity": {}
        }
      },
      "location": "East US",
      "properties": {
        "appInsightsConfiguration": {
          "connectionString": "InstrumentationKey=00000000-0000-0000-0000-000000000000;IngestionEndpoint=https://eastus-8.in.applicationinsights.azure.com/;LiveEndpoint=https://eastus.livediagnostics.monitor.azure.com/"
        },
        "appLogsConfiguration": {
          "logAnalyticsConfiguration": {
            "customerId": "string",
            "dynamicJsonColumns": true,
            "sharedKey": "string"
          }
        },
        "availabilityZones": [
          "1",
          "2",
          "3"
        ],
        "customDomainConfiguration": {
          "certificatePassword": "1234",
          "certificateValue": "Y2VydA==",
          "dnsSuffix": "www.my-name.com"
        },
        "daprAIConnectionString": "InstrumentationKey=00000000-0000-0000-0000-000000000000;IngestionEndpoint=https://northcentralus-0.in.applicationinsights.azure.com/",
        "diskEncryptionConfiguration": {
          "keyVaultConfiguration": {
            "auth": {
              "identity": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/contoso-resources/providers/Microsoft.ManagedIdentity/userAssignedIdentities/contoso-identity"
            },
            "keyUrl": "https://contoso.vault.azure.net/mykey/19ff8313ca394b89b9e824bbbdc8c521"
          }
        },
        "ingressConfiguration": {
          "headerCountLimit": 30,
          "requestIdleTimeout": 5,
          "terminationGracePeriodSeconds": 3600,
          "workloadProfileName": "My-CO-01"
        },
        "openTelemetryConfiguration": {
          "destinationsConfiguration": {
            "dataDogConfiguration": {
              "key": "000000000000000000000000",
              "site": "string"
            },
            "otlpConfigurations": [
              {
                "name": "dashboard",
                "endpoint": "dashboard.k8s.region.azurecontainerapps.io:80",
                "headers": [
                  {
                    "key": "api-key",
                    "value": "xxxxxxxxxxx"
                  }
                ],
                "insecure": true
              }
            ]
          },
          "logsConfiguration": {
            "destinations": [
              "appInsights"
            ]
          },
          "metricsConfiguration": {
            "destinations": [
              "dataDog"
            ],
            "includeKeda": true
          },
          "tracesConfiguration": {
            "destinations": [
              "appInsights"
            ],
            "includeDapr": true
          }
        },
        "peerAuthentication": {
          "mtls": {
            "enabled": true
          }
        },
        "peerTrafficConfiguration": {
          "encryption": {
            "enabled": true
          }
        },
        "vnetConfiguration": {
          "infrastructureSubnetId": "/subscriptions/34adfa4f-cedf-4dc0-ba29-b6d1a69ab345/resourceGroups/RGName/providers/Microsoft.Network/virtualNetworks/VNetName/subnets/subnetName1"
        },
        "workloadProfiles": [
          {
            "name": "My-GP-01",
            "enableFips": true,
            "maximumCount": 12,
            "minimumCount": 3,
            "workloadProfileType": "GeneralPurpose"
          },
          {
            "name": "My-MO-01",
            "maximumCount": 6,
            "minimumCount": 3,
            "workloadProfileType": "MemoryOptimized"
          },
          {
            "name": "My-CO-01",
            "maximumCount": 6,
            "minimumCount": 3,
            "workloadProfileType": "ComputeOptimized"
          },
          {
            "name": "My-consumption-01",
            "workloadProfileType": "Consumption"
          }
        ],
        "zoneRedundant": true
      }
    },
    "environmentName": "testcontainerenv",
    "resourceGroupName": "examplerg",
    "subscriptionId": "34adfa4f-cedf-4dc0-ba29-b6d1a69ab345"
  },
  "responses": {
    "200": {
      "body": {
        "name": "testcontainerenv",
        "type": "Microsoft.App/managedEnvironments",
        "id": "/subscriptions/34adfa4f-cedf-4dc0-ba29-b6d1a69ab345/resourceGroups/examplerg/providers/Microsoft.App/managedEnvironments/testcontainerenv",
        "identity": {
          "type": "SystemAssigned, UserAssigned",
          "principalId": "00000000-0000-0000-0000-000000000000",
          "tenantId": "00000000-0000-0000-0000-000000000000",
          "userAssignedIdentities": {
            "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/contoso-resources/providers/Microsoft.ManagedIdentity/userAssignedIdentities/contoso-identity": {
              "clientId": "00000000-0000-0000-0000-000000000000",
              "principalId": "00000000-0000-0000-0000-000000000000"
            }
          }
        },
        "location": "East US",
        "properties": {
          "appInsightsConfiguration": null,
          "appLogsConfiguration": {
            "logAnalyticsConfiguration": {
              "customerId": "string",
              "dynamicJsonColumns": true
            }
          },
          "availabilityZones": [
            "1",
            "2",
            "3"
          ],
          "customDomainConfiguration": {
            "customDomainVerificationId": "custom domain verification id",
            "dnsSuffix": "www.my-name.com",
            "expirationDate": "2022-11-06T04:00:00Z",
            "subjectName": "CN=www.my-name.com",
            "thumbprint": "CERTIFICATE_THUMBPRINT"
          },
          "defaultDomain": "testcontainerenv.k4apps.io",
          "deploymentErrors": null,
          "diskEncryptionConfiguration": {
            "keyVaultConfiguration": {
              "auth": {
                "identity": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/contoso-resources/providers/Microsoft.ManagedIdentity/userAssignedIdentities/contoso-identity"
              },
              "keyUrl": "https://contoso.vault.azure.net/mykey/19ff8313ca394b89b9e824bbbdc8c521"
            }
          },
          "eventStreamEndpoint": "testEndpoint",
          "infrastructureResourceGroup": "capp-svc-testcontainerenv-eastus",
          "ingressConfiguration": {
            "headerCountLimit": 30,
            "requestIdleTimeout": 5,
            "terminationGracePeriodSeconds": 3600,
            "workloadProfileName": "My-CO-01"
          },
          "openTelemetryConfiguration": {
            "destinationsConfiguration": {
              "dataDogConfiguration": {
                "key": null,
                "site": "datadoghq.com"
              },
              "otlpConfigurations": [
                {
                  "name": "dashboard",
                  "endpoint": "dashboard.k8s.region.azurecontainerapps.io:80",
                  "insecure": true
                }
              ]
            },
            "logsConfiguration": {
              "destinations": [
                "appInsights"
              ]
            },
            "metricsConfiguration": {
              "destinations": [
                "dataDog"
              ]
            },
            "tracesConfiguration": {
              "destinations": [
                "appInsights"
              ]
            }
          },
          "peerAuthentication": {
            "mtls": {
              "enabled": true
            }
          },
          "provisioningState": "Succeeded",
          "staticIp": "1.2.3.4",
          "vnetConfiguration": {
            "infrastructureSubnetId": "/subscriptions/34adfa4f-cedf-4dc0-ba29-b6d1a69ab345/resourceGroups/RGName/providers/Microsoft.Network/virtualNetworks/VNetName/subnets/subnetName1"
          },
          "workloadProfiles": [
            {
              "name": "My-GP-01",
              "enableFips": true,
              "maximumCount": 12,
              "minimumCount": 3,
              "workloadProfileType": "GeneralPurpose"
            },
            {
              "name": "My-MO-01",
              "maximumCount": 6,
              "minimumCount": 3,
              "workloadProfileType": "MemoryOptimized"
            },
            {
              "name": "My-CO-01",
              "maximumCount": 6,
              "minimumCount": 3,
              "workloadProfileType": "ComputeOptimized"
            },
            {
              "name": "My-consumption-01",
              "workloadProfileType": "Consumption"
            }
          ],
          "zoneRedundant": true
        }
      }
    },
    "201": {
      "body": {
        "name": "testcontainerenv",
        "type": "Microsoft.App/managedEnvironments",
        "id": "/subscriptions/34adfa4f-cedf-4dc0-ba29-b6d1a69ab345/resourceGroups/examplerg/providers/Microsoft.App/managedEnvironments/testcontainerenv",
        "identity": {
          "type": "SystemAssigned, UserAssigned",
          "principalId": "00000000-0000-0000-0000-000000000000",
          "tenantId": "00000000-0000-0000-0000-000000000000",
          "userAssignedIdentities": {
            "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/contoso-resources/providers/Microsoft.ManagedIdentity/userAssignedIdentities/contoso-identity": {
              "clientId": "00000000-0000-0000-0000-000000000000",
              "principalId": "00000000-0000-0000-0000-000000000000"
            }
          }
        },
        "location": "East US",
        "properties": {
          "appInsightsConfiguration": null,
          "appLogsConfiguration": {
            "logAnalyticsConfiguration": {
              "customerId": "string"
            }
          },
          "availabilityZones": [
            "1",
            "2",
            "3"
          ],
          "customDomainConfiguration": {
            "customDomainVerificationId": "custom domain verification id",
            "dnsSuffix": "www.my-name.com",
            "expirationDate": "2022-11-06T04:00:00Z",
            "subjectName": "CN=www.my-name.com",
            "thumbprint": "CERTIFICATE_THUMBPRINT"
          },
          "defaultDomain": "testcontainerenv.k4apps.io",
          "deploymentErrors": null,
          "diskEncryptionConfiguration": {
            "keyVaultConfiguration": {
              "auth": {
                "identity": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/contoso-resources/providers/Microsoft.ManagedIdentity/userAssignedIdentities/contoso-identity"
              },
              "keyUrl": "https://contoso.vault.azure.net/mykey/19ff8313ca394b89b9e824bbbdc8c521"
            }
          },
          "eventStreamEndpoint": "testEndpoint",
          "infrastructureResourceGroup": "capp-svc-testcontainerenv-eastus",
          "ingressConfiguration": {
            "headerCountLimit": 30,
            "requestIdleTimeout": 5,
            "terminationGracePeriodSeconds": 3600,
            "workloadProfileName": "My-CO-01"
          },
          "openTelemetryConfiguration": {
            "destinationsConfiguration": {
              "dataDogConfiguration": {
                "key": null,
                "site": "datadoghq.com"
              },
              "otlpConfigurations": [
                {
                  "name": "dashboard",
                  "endpoint": "dashboard.k8s.region.azurecontainerapps.io:80",
                  "insecure": true
                }
              ]
            },
            "logsConfiguration": {
              "destinations": [
                "appInsights"
              ]
            },
            "metricsConfiguration": {
              "destinations": [
                "dataDog"
              ]
            },
            "tracesConfiguration": {
              "destinations": [
                "appInsights"
              ]
            }
          },
          "peerAuthentication": {
            "mtls": {
              "enabled": true
            }
          },
          "provisioningState": "InitializationInProgress",
          "staticIp": "1.2.3.4",
          "vnetConfiguration": {
            "infrastructureSubnetId": "/subscriptions/34adfa4f-cedf-4dc0-ba29-b6d1a69ab345/resourceGroups/RGName/providers/Microsoft.Network/virtualNetworks/VNetName/subnets/subnetName1"
          },
          "workloadProfiles": [
            {
              "name": "My-GP-01",
              "enableFips": true,
              "maximumCount": 12,
              "minimumCount": 3,
              "workloadProfileType": "GeneralPurpose"
            },
            {
              "name": "My-MO-01",
              "maximumCount": 6,
              "minimumCount": 3,
              "workloadProfileType": "MemoryOptimized"
            },
            {
              "name": "My-CO-01",
              "maximumCount": 6,
              "minimumCount": 3,
              "workloadProfileType": "ComputeOptimized"
            },
            {
              "name": "My-consumption-01",
              "workloadProfileType": "Consumption"
            }
          ],
          "zoneRedundant": true
        }
      }
    }
  },
  "operationId": "ManagedEnvironments_CreateOrUpdate",
  "title": "Create environments"
}
